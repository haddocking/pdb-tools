---
name: Bump_and_Package

on:
  push:
    branches:
      - master

jobs:
  bump-version:
    runs-on: ubuntu-latest

    permissions:
      contents: write
      pull-requests: write

    steps:
      - name: Determine bump type
        id: determine-bump
        run: |
          COMMIT_MSG="${{ github.event.head_commit.message }}"
          echo "PR title: $COMMIT_MSG"
          if [[ "$COMMIT_MSG" =~ ^\[MAJOR\] ]]; then
            echo "bump-type=major" >> $GITHUB_OUTPUT
          elif [[ "$COMMIT_MSG" =~ ^\[MINOR\] ]]; then
            echo "bump-type=minor" >> $GITHUB_OUTPUT
          elif [[ "$COMMIT_MSG" =~ ^\[PATCH\] ]]; then
            echo "bump-type=patch" >> $GITHUB_OUTPUT
          elif [[ "$COMMIT_MSG" =~ ^\[SKIP\] ]]; then
            echo "skip-bump=true" >> $GITHUB_OUTPUT
            echo "::notice::Version bump skipped based on PR title"
            exit 0
          else
            echo "::error::PR title must start with [MAJOR], [MINOR], [PATCH], or [SKIP]"
            exit 1
          fi

      - name: Bump version
        if: steps.determine-bump.outputs.skip-bump != 'true'
        id: bump
        uses: callowayproject/bump-my-version@master
        with:
          args: ${{ steps.determine-bump.outputs.bump-type }} setup.py -v
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }} # Default token for GitHub Actions


      ## TODO: Publish it on PyPI
